(self.webpackChunkvk=self.webpackChunkvk||[]).push([[25077],{91047:(e,t,r)=>{"use strict";function i(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function n(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=i(r);return(e,r)=>n.then((i=>r(i.transaction(t,e).objectStore(t))))}let s;function a(){return s||(s=n("keyval-store","keyval")),s}function o(e,t=a()){return t("readonly",(t=>i(t.get(e))))}function c(e,t,r=a()){return r("readwrite",(r=>(r.put(t,e),i(r.transaction))))}function l(e,t=a()){return t("readwrite",(t=>(t.delete(e),i(t.transaction))))}function u(e=a()){return e("readwrite",(e=>(e.clear(),i(e.transaction))))}r.d(t,{clear:()=>u,createStore:()=>n,del:()=>l,get:()=>o,set:()=>c})},54921:(e,t,r)=>{"use strict";r.d(t,{STICKER_PACK_ICON:()=>o,STICKER_PACK_THUMB:()=>c,STICKER_IMAGE:()=>l,STICKER_ANIMATION:()=>u,DEFAULT_CACHE:()=>d,SAMPLE_RECIPIENT_ID:()=>_,ORDER_ERRORS:()=>n,ORDER_ITEM_ERRORS:()=>s});var i,n,s,a=r(49091),o={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},c={"102_png":{id:"102.png",width:102,height:102,theme:a.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:a.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:a.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:a.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:a.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:a.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:a.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:a.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:a.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:a.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:a.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:a.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},l={"64_png":{id:"64.png",width:64,height:64,theme:a.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:a.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:a.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:a.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:a.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:a.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:a.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:a.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:a.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:a.Theme.DARK}},u=((i={})[a.Theme.LIGHT]="animation.json",i[a.Theme.DARK]="animation.b.json",i),d={products:(0,a.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},_=-1;!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(n||(n={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(s||(s={}))},49091:(e,t,r)=>{"use strict";var i;r.d(t,{Theme:()=>i,imageSizesIndex:()=>s,imageSizeCache:()=>a,createProductsMap:()=>o,UserProductStateKey:()=>n,isBasePack:()=>l,isStyleProduct:()=>u,isPackProduct:()=>d,ProductsByType:()=>_}),function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(i||(i={}));var n,s=Symbol(),a=Symbol(),o=function(e){return new Map(e)};!function(e){e.IsNew="is_new"}(n||(n={}));var c,l=function(e){return void 0!==e.sticker_ids},u=function(e){return void 0!==e.base_id},d=function(e){return l(e)&&!u(e)};!function(e){e.Pack="pack",e.Style="style"}(c||(c={}));var _=function(){function e(e){var t=this;void 0===e&&(e=[]),this.pack=new Set,this.style=new Set,e.forEach((function(e){return t.add(e)}))}return e.prototype.add=function(e){e&&(d(e)?this.pack.add(e):u(e)&&this.style.add(e))},e.prototype.getPack=function(){return this.pack.values().next().value},e.prototype.getStyles=function(){return Array.from(this.style.values())},e.prototype.getCount=function(){return this.pack.size+this.style.size},e}();!function(){function e(e){var t=this;this.pack=[],this.style=[],e.forEach((function(e){return t.add(e)}))}e.prototype.add=function(e){var t=e.product;t&&(d(t)?this.pack.push(e):u(t)&&this.style.push(e))}}()},22377:(e,t,r)=>{"use strict";r.d(t,{getStickerImageUrl:()=>o,getStickerAnimationUrl:()=>c,getStickerPackIconUrl:()=>l,isSampleOrderItem:()=>u});var i=r(70655),n=r(49091),s=r(54921),a=function(e,t,r,i){void 0===i&&(i=n.Theme.DEFAULT);var s=window.devicePixelRatio,a=[t*=s,r*=s,i].toString(),o=e[n.imageSizeCache];if(o&&o.has(a)){var c=o.get(a);if(c)return c}o||(o=new Map,e[n.imageSizeCache]=o);var l=function(e){var t=e[n.imageSizesIndex];return t||(t=Object.values(e).sort((function(e,t){return e.width-t.width||e.height-t.height})),e[n.imageSizesIndex]=t),t}(e).filter((function(e){return!e.theme||e.theme===i})),u=l.find((function(e){return e.width>=t&&e.height>=r}))||l[l.length-1];return o.set(a,u),u};function o(e,t,r,o){var c,l,u;if(void 0===o&&(o=n.Theme.DEFAULT),null===(u=e.render)||void 0===u?void 0:u.images){var d=e.render.images;d.sort((function(e,t){return e.width-t.width||e.height-t.height}));var _=void 0;try{for(var h=(0,i.__values)(d),f=h.next();!f.done;f=h.next()){var p=f.value;if(p.width>=t&&p.height>=r){if(p.theme===o)return p.url;_=p}}}catch(e){c={error:e}}finally{try{f&&!f.done&&(l=h.return)&&l.call(h)}finally{if(c)throw c.error}}if(_)return _.url}return function(e,t){return e.image.base_url+"/"+t.id+(e.image.version?"?"+e.image.version:"")}(e,function(e,t,r){return void 0===r&&(r=n.Theme.DEFAULT),a(s.STICKER_IMAGE,e,t,r)}(t,r,o))}var c=function(e,t){return void 0===t&&(t=n.Theme.DEFAULT),e.animation?e.animation.base_url+"/"+s.STICKER_ANIMATION[t]+(e.animation.version?"?"+e.animation.version:""):""},l=function(e,t,r,i){return void 0===i&&(i=n.Theme.DEFAULT),function(e,t){return e.icon.base_url+"/"+t.id+(e.thumb.version?"?"+e.thumb.version:"")}(e,function(e,t,r){return void 0===r&&(r=n.Theme.DEFAULT),a(s.STICKER_PACK_ICON,e,t,r)}(t,r,i))},u=function(e){return e.recipient_id===s.SAMPLE_RECIPIENT_ID}},30304:(e,t,r)=>{"use strict";r.d(t,{moveStickersHintsToStickerPicker:()=>n});var i="StickersHints__marginTransition",n=function(e,t){var r=window.Emoji.opts[e];if(null==r?void 0:r.txt){var n=r.txt.parentNode.querySelector("._sticker_hints");if(n)if("none"!==getComputedStyle(n).getPropertyValue("display")){t&&(n.classList.add(i),requestAnimationFrame((function(){return n.classList.remove(i)}))),n.style.setProperty("margin-left","0px");var s=n.getBoundingClientRect().right;if(window.StickerPickerViewer){var a=window.StickerPickerViewer,o=a.isShown,c=a.isDown,l=a.viewWrapper;if(!o||!l||c)return;var u=-(s-l.getBoundingClientRect().left+10);n.style.setProperty("margin-left",u+"px")}}}}},65820:(e,t,r)=>{"use strict";r.d(t,{getCache:()=>l,updateCache:()=>u,getSticker:()=>d,getStickers:()=>_,getPackByStickerId:()=>f});var i=r(70655),n=r(93680),s=r(54921),a=r(49091),o=r(10835),c=r(26330),l=function(){if(!window.stickersCache){var e=c.default.get("stickers_cache");window.stickersCache=(0,i.__assign)((0,i.__assign)({},s.DEFAULT_CACHE),e)}return window.stickersCache},u=function(e){window.stickersCache=(0,i.__assign)((0,i.__assign)({},l()),e)},d=function(e){return l().stickers.get(e)},_=function(e){var t=l().stickers;return e.map((function(e){return t.get(e)}))},h=function(e){var t=d(e);if(!t||!t.pack_id)return null;var r=(0,o.getProductFromCache)(t.pack_id);return r&&(0,a.isBasePack)(r)?r:null},f=function(e){var t=h(e);return t?Promise.resolve(t):new Promise((function(t){n.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone:function(r){(0,o.cacheProductsData)(r),t(h(e))},onFail:function(e){return console.error(e),t(null),!0}})}))}},99321:(e,t,r)=>{"use strict";r.d(t,{Cart:()=>c});var i=r(70655),n=r(93680),s=r(54722),a=r(54921),o=r(10835),c=function(){function e(e,t){void 0===t&&(t=[]),this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}return e.create=function(t,r){return void 0===r&&(r=[]),new e(t.map((function(e){return{product_id:e,amount:1}})),r)},e.prototype.copy=function(){var t=new e(this.getItems(),this.getRecipientIds());return t.setOrder(this.getOrder()),t},e.prototype.getItems=function(){return Array.from(this.items.values())},e.prototype.setItems=function(e){this.items=new Map(e.map((function(e){return[e.product_id,e]})))},e.prototype.loadItems=function(){var e=this,t=Array.from(this.items.keys());return(0,o.getProducts)(t).then((function(){var t,r;try{for(var n=(0,i.__values)(Array.from(e.items.values())),s=n.next();!s.done;s=n.next()){var a=s.value;a.product=(0,o.getProductFromCache)(a.product_id)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}))},e.prototype.getProducts=function(){return(0,o.getProductsFromCache)(Array.from(this.items.keys()))},e.prototype.hasProduct=function(e){return this.items.has(e)},e.prototype.addProduct=function(e,t){if(void 0===t&&(t=!1),!this.hasProduct(e)){var r={product_id:e,amount:1};t?this.setItems((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.getItems()),!1),[r],!1)):this.setItems((0,i.__spreadArray)([r],(0,i.__read)(this.getItems()),!1)),this.onChange&&this.onChange()}},e.prototype.removeProduct=function(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())},e.prototype.getRecipientIds=function(e){return void 0===e&&(e=!1),this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[a.SAMPLE_RECIPIENT_ID]:[]},e.prototype.setRecipientIds=function(e){this.recipientIds=new Set(e)},e.prototype.hasRecipientId=function(e){return this.recipientIds.has(e)},e.prototype.addRecipientId=function(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())},e.prototype.removeRecipientId=function(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())},e.prototype.setOrder=function(e){var t,r;if(this._order=e,e){this.recipientIds.clear();try{for(var n=(0,i.__values)(e.items),s=n.next();!s.done;s=n.next()){var o=s.value;o.recipient_id!==a.SAMPLE_RECIPIENT_ID&&this.recipientIds.add(o.recipient_id)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}},e.prototype.loadOrder=function(e){var t=e.items.map((function(e){return e.product_id}));return(0,o.getProducts)(t).then((function(t){return(0,i.__assign)((0,i.__assign)({},e),{items:e.items.map((function(e,r){return(0,i.__assign)((0,i.__assign)({},e),{product:t[r]})}))})}),(function(){return e}))},e.prototype.getOrder=function(){return this._order},e.prototype.getRecipientsMap=function(){return this.recipients},e.prototype.getRecipients=function(){return Array.from(this.recipients.values())},e.prototype.getRecipientById=function(e){return this.recipients.get(e)},e.prototype.addRecipients=function(e){this.recipients=new Map((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.getRecipients()),!1),(0,i.__read)(e),!1).map((function(e){return[e[0],e]})))},e.prototype.getJSON=function(){return JSON.stringify({items:this.getItems().map((function(e){return(0,i.__assign)((0,i.__assign)({},e),{product:void 0})})),recipient_ids:this.getRecipientIds(!0)})},e.prototype.isLoaded=function(){return null!==this.getOrder()},e.prototype.cancelLoad=function(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)},e.prototype.load=function(e){var t=this;return void 0===e&&(e=!1),this.cancelLoad(),new Promise((function(r){t.loadTimeout=window.setTimeout((function(){t.loadCancellationToken=new s.AjaxCancellationToken,n.ajax.post("stickers.php",{act:"preview_products_order",cart:t.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:t.loadCancellationToken,onDone:function(e){(0,o.cacheProductsData)(e),Promise.all([t.loadItems(),t.loadOrder(e.order)]).then((function(n){var s=(0,i.__read)(n,2)[1];t.setOrder(s),e.recipients&&t.addRecipients(e.recipients),r(t)}),(function(){}))},onFail:function(e){return e&&window.__dev&&console.error(e),r(t),!0}})}),300)}))},e.prototype.order=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(r){var s;n.ajax.post("stickers.php",{act:"order_products",cart:t.getJSON(),hash:e.hash||(null===(s=t.getOrder())||void 0===s?void 0:s.hash),message:e.message,is_private:e.is_private?1:0,ref:e.ref,gift_ref:e.gift_ref},{onDone:function(e){(0,o.cacheProductsData)(e),Promise.all([t.loadOrder(e.order),t.loadOrder(e.result)]).then((function(e){var n=(0,i.__read)(e,2),s=n[0],a=n[1];t.setOrder(s),r(a)}),(function(){}))},onFail:function(e){return e&&console.error(e),r(null),!0}})}))},e}()},69783:(e,t,r)=>{"use strict";r.d(t,{default:()=>_});var i=r(70655),n=r(85893),s=r(67294),a=r(86067),o=r(83295),c=r(41650),l=r(18690),u=c.default.getLang,d=function(e){var t=e.className,r=e.price,c=e.text,d=e.placeholder,_=(0,i.__rest)(e,["className","price","text","placeholder"]),h=(0,s.useMemo)((function(){if(r){var e;r.current!==r.regular&&r.regular&&(e=(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__regular"},{children:r.current?r.regular:(0,a.langStr)(u("purchases_stickers_n_for_m"),"%n","","%m",u("global_n_votes",r.regular))}),"regular"));var t=(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__current"},{children:r.current?u("global_n_votes",r.current):u("purchases_for_free_btn").toLowerCase()}),"current");return c?c.split(/(\{regular_price\}|\{price\})/).map((function(r,s){return"{regular_price}"===r?e:"{price}"===r?t:r?(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__label"},{children:r}),"label"+s):void 0})):[e,t]}return[d]}),[c,d,null==r?void 0:r.regular,null==r?void 0:r.current]);return(0,n.jsx)(l.default,(0,i.__assign)({className:(0,o.classNames)("StickersPriceButton",t)},_,{children:h}),void 0)};d.defaultProps=(0,i.__assign)({},l.default.defaultProps);const _=d},50134:(e,t,r)=>{"use strict";r.d(t,{useCart:()=>s});var i=r(70655),n=r(67294),s=function(e){var t=(0,i.__read)((0,n.useState)(e),2),r=t[0],s=t[1],a=(0,i.__read)((0,n.useState)(null),2),o=a[0],c=a[1],l=(0,n.useCallback)((function(){var e=r.load();c(e),e.then((function(t){s(t),c((function(t){return t===e?null:t}))}),(function(){}))}),[r]);return(0,n.useEffect)((function(){return r.onChange=l,r.isLoaded()||l(),function(){r.onChange=null,r.cancelLoad()}}),[r]),[r,null!==o]}},41576:(e,t,r)=>{"use strict";r.d(t,{previewSticker:()=>ye,previewStickerProduct:()=>we});var i=r(70655),n=r(85893),s=r(73935),a=r(54612),o=r(86067),c=r(49091),l=r(10835),u=r(65820),d=r(99321),_=r(86125),h=r(67294),f=r(41650),p=r(13984),g=r(88420),v=r(18690),m=r(33024);const k=(0,r(63192).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0);var S=r(54921),y=r(48230),w=function(e){var t=(0,i.__read)(function(e){var t=(0,i.__read)((0,h.useState)({}),2)[1],r=(0,l.getProductFromCache)(e);return void 0===r?((0,l.getProduct)(e,!1).then((function(){return t({})}),(function(){})),[r,!0]):[r,!1]}(e),2),r=t[0],n=t[1];return r&&(0,c.isPackProduct)(r)?[r,n]:[void 0===r?void 0:null,n]},P=function(e){var t=(0,i.__read)((0,h.useState)({}),2)[1],r=(0,l.getProductsFromCache)(e);return r.some((function(e){return void 0===e}))?((0,l.getProducts)(e,!1).then((function(){return t({})}),(function(){})),[r,!0]):[r,!1]},x=function(e){var t,r,n=(0,i.__read)(P(e),2),s=n[0],a=n[1],o=[];try{for(var l=(0,i.__values)(s),u=l.next();!u.done;u=l.next()){var d=u.value;d&&(0,c.isStyleProduct)(d)&&o.push(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return[o,a]};var I=r(50134),N="Invariant failed";const j=function(e,t){if(!e)throw new Error(N)};function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},C.apply(this,arguments)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var R=new Map,M=new Map,L=new Map,A=0;function G(e,t,r){void 0===r&&(r={}),r.threshold||(r.threshold=0);var i=r,n=i.root,s=i.rootMargin,a=i.threshold;if(R.has(e)&&j(!1),e){var o=function(e){return e?L.has(e)?L.get(e):(A+=1,L.set(e,A.toString()),L.get(e)+"_"):""}(n)+(s?a.toString()+"_"+s:a.toString()),c=M.get(o);c||(c=new IntersectionObserver(E,r),o&&M.set(o,c));var l={callback:t,element:e,inView:!1,observerId:o,observer:c,thresholds:c.thresholds||(Array.isArray(a)?a:[a])};return R.set(e,l),c.observe(e),l}}function D(e){if(e){var t=R.get(e);if(t){var r=t.observerId,i=t.observer,n=i.root;i.unobserve(e);var s=!1,a=!1;r&&R.forEach((function(t,i){i!==e&&(t.observerId===r&&(s=!0,a=!0),t.observer.root===n&&(a=!0))})),!a&&n&&L.delete(n),i&&!s&&i.disconnect(),R.delete(e)}}}function E(e){e.forEach((function(e){var t=e.isIntersecting,r=e.intersectionRatio,i=e.target,n=R.get(i);if(n&&r>=0){var s=n.thresholds.some((function(e){return n.inView?r>e:r>=e}));void 0!==t&&(s=s&&t),n.inView=s,n.callback(s,e)}}))}var B=function(e){var t,r;function i(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return b(T(t=e.call.apply(e,[this].concat(i))||this),"state",{inView:!1,entry:void 0}),b(T(t),"node",null),b(T(t),"handleNode",(function(e){t.node&&(D(t.node),e||t.props.triggerOnce||t.setState({inView:!1,entry:void 0})),t.node=e||null,t.observeNode()})),b(T(t),"handleChange",(function(e,r){(e!==t.state.inView||e)&&t.setState({inView:e,entry:r}),t.props.onChange&&t.props.onChange(e,r)})),t}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var n=i.prototype;return n.componentDidMount=function(){this.node||j(!1)},n.componentDidUpdate=function(e,t){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(D(this.node),this.observeNode()),t.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(D(this.node),this.node=null)},n.componentWillUnmount=function(){this.node&&(D(this.node),this.node=null)},n.observeNode=function(){if(this.node){var e=this.props,t=e.threshold,r=e.root,i=e.rootMargin;G(this.node,this.handleChange,{threshold:t,root:r,rootMargin:i})}},n.render=function(){var e=this.state,t=e.inView,r=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:t,entry:r,ref:this.handleNode});var i=this.props,n=i.children,s=i.as,a=i.tag,o=(i.triggerOnce,i.threshold,i.root,i.rootMargin,i.onChange,function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(i,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return(0,h.createElement)(s||a||"div",C({ref:this.handleNode},o),n)},i}(h.Component);b(B,"displayName","InView"),b(B,"defaultProps",{threshold:0,triggerOnce:!1});var O={inView:!1,entry:void 0};var H=r(83295),F=r(22377);const V=function(e){var t=e.className,r=e.sticker,s=e.theme,a=e.width,o=e.height,c=e.isInView,l=void 0===c||c,u=(0,h.useRef)(null),d=(0,F.getStickerImageUrl)(r,a,o,s);return(0,h.useLayoutEffect)((function(){u.current&&u.current.src!==d&&l&&(u.current.src=d)}),[l,d]),(0,n.jsx)("div",(0,i.__assign)({className:(0,H.classNames)("StickerImage",t),style:{width:a,height:o}},{children:(0,n.jsx)("img",{className:"StickerImage__image",ref:u},void 0)}),void 0)};var U=r(11248),z=r.n(U);const K=function(e){var t=e.className,r=e.sticker,s=e.theme,a=e.width,o=e.height,c=e.isInView,l=void 0===c||c,u=e.play,d=void 0!==u&&u,_=(0,h.useRef)(null),f=(0,i.__read)((0,h.useState)(null),2),p=f[0],g=f[1],v=(0,F.getStickerAnimationUrl)(r,s);return(0,h.useEffect)((function(){if(p&&p.isLoaded){var e=d&&l;e&&!p.playing&&(p.item.play(),g((0,i.__assign)((0,i.__assign)({},p),{playing:!0}))),!e&&p.playing&&(p.item.pause(),g((0,i.__assign)((0,i.__assign)({},p),{playing:!1})))}}),[p,d,l]),(0,h.useEffect)((function(){if(!p||p.url!==v)if(p&&p.item.destroy(),v&&l){var e=z().loadAnimation({container:_.current,path:v,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:v,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(function(){g((0,i.__assign)((0,i.__assign)({},t),{isLoaded:!0}))})),g(t)}else g(null)}),[v,l]),(0,n.jsx)("div",{className:(0,H.classNames)("StickerAnimation",t),style:{width:a,height:o},ref:_},void 0)};const W=function(e){var t=e.className,r=e.sticker,s=e.theme,a=void 0===s?c.Theme.LIGHT:s,o=e.width,l=e.height,u=(0,i.__read)(function(e){void 0===e&&(e={});var t=(0,h.useRef)(),r=(0,h.useState)(O),i=r[0],n=r[1],s=(0,h.useCallback)((function(r){t.current&&D(t.current),r&&G(r,(function(t,i){n({inView:t,entry:i}),t&&e.triggerOnce&&D(r)}),e),t.current=r}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return(0,h.useEffect)((function(){t.current||i===O||e.triggerOnce||n(O)})),[s,i.inView,i.entry]}({threshold:0}),2),d=u[0],_=u[1],f=void 0!==r.animation,p=(0,i.__read)((0,h.useState)(!1),2),g=p[0],v=p[1];return(0,n.jsx)("div",(0,i.__assign)({className:(0,H.classNames)("Sticker",t),ref:d,onMouseEnter:function(){v(!0)},onMouseLeave:function(){v(!1)}},{children:f?(0,n.jsx)(K,{sticker:r,theme:a,width:o,height:l,isInView:_,play:g},void 0):(0,n.jsx)(V,{sticker:r,theme:a,width:o,height:l,isInView:_},void 0)}),void 0)};var q=r(47560),Q=r(99940),$=r(79806),J={getOffset:function(){return{x:0,y:0}},scrollTo:function(){},scrollBy:function(){},onWheel:function(){},updateItems:function(){},hasPrev:!1,hasNext:!1,prev:function(){},next:function(){}};function X(e,t){switch(t.type){case"updateState":return(0,i.__assign)((0,i.__assign)({},e),t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?(0,i.__assign)((0,i.__assign)({},e),{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}var Z=function(e){for(var t=Array.from(e.entries()),r=0;r<t.length;r++){var n=(0,i.__read)(t[r],2),s=n[0],a=n[1];if(a&&a.intersectionRatio)return a.intersectionRatio<1?s:t[r-1]?t[r-1][0]:null}return null},Y=function(e){for(var t=Array.from(e.entries()),r=t.length-1;r>=0;r--){var n=(0,i.__read)(t[r],2),s=n[0],a=n[1];if(a&&a.intersectionRatio)return a.intersectionRatio<1?s:t[r+1]?t[r+1][0]:null}return null};const ee=function(e){var t=(0,h.useRef)(null),r=(0,i.__read)((0,h.useReducer)(X,J),2),n=r[0],s=r[1],a=(0,h.useCallback)((function(e){s({type:"updateState",state:e})}),[s]),o=(0,h.useCallback)((function(r){if(t.current&&n.onMouseWheel&&t.current.removeEventListener("mousewheel",n.onMouseWheel),r){var o=r.querySelector(e.wrapperSelector);if(o){var c,l={x:0,y:0},u=new Map,d=function(t){var i=0;o.offsetWidth>r.offsetWidth&&(i=Math.max(0,Math.min(o.offsetWidth-r.offsetWidth,t.x)));var n=0;o.offsetHeight>r.offsetHeight&&(n=Math.max(0,Math.min(o.offsetHeight-r.offsetHeight,t.y))),o.style.transform="translate3d(-"+i+"px, -"+n+"px, 0)",o.style.transitionDuration=t.noTransition?"0s":"",l={x:i,y:n},e.onScroll&&e.onScroll(i,n)},_=function(e){d((0,i.__assign)((0,i.__assign)({},e),{x:l.x+e.x,y:l.y+e.y}))},h=function(e){e.deltaX&&e.preventDefault()};r.addEventListener("mousewheel",h),a((0,i.__assign)((0,i.__assign)({},n),{onMouseWheel:h,updateItems:function(){var t,n;c&&c.disconnect(),c=new IntersectionObserver((function(e){var t,r;try{for(var n=(0,i.__values)(e),a=n.next();!a.done;a=n.next()){var o=a.value;u.has(o.target)&&u.set(o.target,o)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}s({type:"updateNav",hasPrev:null!==Z(u),hasNext:null!==Y(u)})}),{root:r,threshold:[0,1]}),u.clear();try{for(var a=(0,i.__values)(r.querySelectorAll(e.itemSelector)),o=a.next();!o.done;o=a.next()){var l=o.value;u.set(l,null),c.observe(l)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},getOffset:function(){return l},scrollTo:d,scrollBy:_,onWheel:function(e){_({x:e.deltaX,y:e.deltaY,noTransition:!0})},prev:function(){var e=Z(u);if(e){var t=getComputedStyle(o),r=parseInt(t.paddingLeft)||0,i=parseInt(t.paddingTop)||0,n=o.getBoundingClientRect(),s=e.getBoundingClientRect();d({x:s.left-n.left-r,y:s.top-n.top-i})}},next:function(){var e=Y(u);if(e){var t=getComputedStyle(o),i=parseInt(t.paddingBottom)||0,n=parseInt(t.paddingRight)||0,s=r.getBoundingClientRect(),a=o.getBoundingClientRect(),c=e.getBoundingClientRect();d({x:c.left-a.left-s.width+c.width+n,y:c.top-a.top-s.height+c.height+i})}}}))}}t.current=r}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,h.useLayoutEffect)((function(){n.updateItems()})),(0,i.__assign)({ref:o},n)};var te=f.default.getLang;const re=function(e){var t,r=e.className,s=e.style,a=e.isAdded,o=void 0!==a&&a,c=e.add,l=e.remove,d=e.gift,_=e.isActive,h=e.isSelected,f=e.select;t=s.is_new?s.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):s.title;var v=(0,u.getSticker)(s.style_sticker_ids[0]),m=function(e){return function(t){t.stopPropagation(),e()}};return(0,n.jsxs)("div",(0,i.__assign)({className:(0,H.classNames)("StickerStylesMenuItem",r,{"StickerStylesMenuItem--selected":Boolean(h),"StickerStylesMenuItem--added":Boolean(o),"StickerStylesMenuItem--new":s.is_new}),onClick:function(){f?f():o?l&&l():c&&c()}},{children:[v&&(0,n.jsx)(W,{className:"StickerStylesMenuItem__icon",sticker:v,width:100,height:100},void 0),(0,n.jsx)(p.default,(0,i.__assign)({element:"div",className:"StickerStylesMenuItem__title"},{children:t}),void 0),s.is_purchased?void 0===_?(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__notice"},{children:te("purchases_stickers_you_have_it")}),void 0):_&&(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__notice"},{children:te("purchases_stickers_active_style")}),void 0):s.price.purchase.regular?(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__price"},{children:te("global_n_votes",s.price.purchase.current)}),void 0):(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__price"},{children:te("purchases_for_free_btn")}),void 0),(c||l||d&&s.can_gift)&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickerStylesMenuItem__actions"},{children:[o?l&&(0,n.jsx)(g.default,(0,i.__assign)({className:"StickerStylesMenuItem__remove",appearance:"secondary",size:"s",onClick:m(l)},{children:te("purchases_stickers_preview_remove_item")}),void 0):c&&(0,n.jsx)(g.default,(0,i.__assign)({className:"StickerStylesMenuItem__add",appearance:"primary",size:"s",onClick:m(c)},{children:te("purchases_stickers_preview_add_item")}),void 0),d&&s.can_gift&&(0,n.jsx)(g.default,(0,i.__assign)({className:"StickerStylesMenuItem__gift",size:"s",appearance:"primary",onClick:m(d)},{children:(0,n.jsx)(k,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"},void 0)}),void 0)]}),void 0)]}),void 0)};var ie=f.default.getLang;const ne=function(e){var t=e.className,r=e.styles,s=e.isLoading,a=e.isAdded,o=e.add,c=e.remove,l=e.gift,u=e.activeStyle,d=e.selectedStyle,_=e.select,h=ee({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(s)return(0,n.jsx)("section",(0,i.__assign)({className:(0,H.classNames)("StickerStylesMenu","StickerStylesMenu--loading",t)},{children:(0,n.jsx)(q.default,{className:"StickerStylesMenu__progress"},void 0)}),void 0);var f=[{title:ie("purchases_stickers_purchased_styles"),styles:r.filter((function(e){return e.is_purchased&&!e.is_disabled}))},{title:ie("purchases_stickers_other_styles"),styles:r.filter((function(e){return!e.is_purchased&&!e.is_disabled&&!e.is_hidden})),tooltip:ie("purchases_stickers_styles_hint")}].filter((function(e){return e.styles.length}));return f.length?(0,n.jsxs)("section",(0,i.__assign)({className:(0,H.classNames)("StickerStylesMenu",t),ref:h.ref,onWheel:function(e){return h.onWheel(e)}},{children:[(0,n.jsx)("a",{className:(0,H.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!h.hasPrev}),onClick:function(){return h.prev()}},void 0),(0,n.jsx)("a",{className:(0,H.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!h.hasNext}),onClick:function(){return h.next()}},void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenu__wrapper"},{children:f.map((function(e,t){return(0,n.jsxs)("section",(0,i.__assign)({className:"StickerStylesMenu__group"},{children:[(0,n.jsxs)("h2",(0,i.__assign)({className:"StickerStylesMenu__groupTitle"},{children:[e.title,e.tooltip&&(0,n.jsx)(Q.default,(0,i.__assign)({className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light"},{children:(0,n.jsx)($.default,{className:"StickerStylesMenu__groupTitleHintIcon"},void 0)}),void 0)]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenu__groupItems"},{children:e.styles.map((function(e){return(0,n.jsx)(re,{className:"StickerStylesMenu__item",style:e,isLoading:s,isAdded:a&&a(e),add:o&&function(){return o(e)},remove:c&&function(){return c(e)},gift:l&&function(){return l(e)},isActive:void 0===u?void 0:e===u,isSelected:void 0===d?void 0:e===d,select:_&&function(){return _(e)}},e.id)}))}),void 0)]}),t)}))}),void 0)]}),void 0):null};var se=r(11417);const ae=function(e){var t=e.className,r=e.product;if(!(0,c.isPackProduct)(r)&&!(0,c.isStyleProduct)(r))return null;var s=(0,u.getStickers)((0,c.isStyleProduct)(r)?r.style_sticker_ids:r.sticker_ids),a=se.colorScheme.isDarkScheme()?c.Theme.DARK:c.Theme.LIGHT;return(0,n.jsx)("div",(0,i.__assign)({className:(0,H.classNames)("StickersProductPreview",t)},{children:(0,n.jsx)("ul",(0,i.__assign)({className:"StickersProductPreview__stickers"},{children:s.map((function(e){return e&&(0,n.jsx)(W,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:a},e.id)}))}),void 0)}),void 0)};var oe=f.default.getLang;const ce=function(e){var t=e.item,r=e.showHeader,s=void 0!==r&&r,a=e.remove;if(!t.product)return null;var l="";return(0,c.isPackProduct)(t.product)?l=(0,o.langStr)(oe("purchases_stickers_product_preview_title_pack"),"title",t.product.title):(0,c.isStyleProduct)(t.product)&&(l=(0,o.langStr)(oe("purchases_stickers_product_preview_title_style"),"title",t.product.title)),(0,n.jsxs)("div",(0,i.__assign)({className:"StickersCartItem"},{children:[s&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickersCartItem__header"},{children:[(0,n.jsx)(p.default,(0,i.__assign)({element:"span",className:"StickersCartItem__title"},{children:l}),void 0),a&&(0,n.jsx)("span",(0,i.__assign)({className:"StickersCartItem__actions"},{children:(0,n.jsx)("button",(0,i.__assign)({className:"StickersCartItem__remove",onClick:function(){return a()}},{children:oe("purchases_stickers_preview_remove_item")}),void 0)}),void 0)]}),void 0),(0,n.jsx)(ae,{className:"StickersCartItem__preview",product:t.product},void 0)]}),void 0)};var le=r(69783),ue=r(40060),de=r(59397),_e=f.default.getLang;const he=function(e){var t=e.pack,r=e.cart,s=e.options,l=s.recipientIds,d=void 0===l?[]:l,f=s.ref,N=s.gift_ref,j=e.closeBox,b=(0,i.__read)(w(t.id),1)[0];b&&(t=b);var C=(0,i.__read)(x(t.style_ids||[]),2),T=C[0],R=C[1],M=(0,i.__read)((0,I.useCart)((function(){return r})),2),L=M[0],A=M[1],G=(0,i.__read)(function(e){var t=(0,i.__read)(P(e.map((function(e){return e.product_id}))),2),r=t[0],n=t[1];return[(0,h.useMemo)((function(){return e.map((function(e,t){return(0,i.__assign)((0,i.__assign)({},e),{product:r[t]})}))}),[e]),n]}(L.getItems()),1),D=G[0],E=L.getProducts(),B=L.getOrder(),O=(0,u.getSticker)(t.sticker_ids[0]),H=function(e){var t,r;if(!e)return null;var n=[],s=[];try{for(var a=(0,i.__values)(e.items),l=a.next();!l.done;l=a.next()){var u=l.value,d=u.product,_=u.error;d&&!_&&((0,c.isPackProduct)(d)?n.push(u):(0,c.isStyleProduct)(d)&&s.push(u))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var h=s.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);if(n.length){var f=n.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);return f?s.length?h?(0,o.langStr)(_e("purchases_stickers_order_summary_pack_for_styles_for",s.length),"pack_price",_e("global_n_votes",f),"styles_num",s.length,"styles_price_sum",h):(0,o.langStr)(_e("purchases_stickers_order_summary_pack_for_styles_free",s.length),"pack_price",_e("global_n_votes",f),"styles_num",s.length):(0,o.langStr)(_e("purchases_stickers_order_summary_pack_for"),"pack_price",_e("global_n_votes",f)):s.length?h?(0,o.langStr)(_e("purchases_stickers_order_summary_pack_free_styles_for",s.length),"styles_num",s.length,"styles_price_sum",_e("global_n_votes",h)):(0,o.langStr)(_e("purchases_stickers_order_summary_pack_free_styles_free",s.length),"styles_num",s.length):(0,o.langStr)(_e("purchases_stickers_order_summary_pack_free"))}if(s.length)return h?(0,o.langStr)(_e("purchases_stickers_order_summary_styles_for",s.length),"styles_num",s.length,"styles_price_sum",_e("global_n_votes",h)):(0,o.langStr)(_e("purchases_stickers_order_summary_styles_free",s.length),"styles_num",s.length);return null}(B),F=!A&&B&&!B.error,V=(0,i.__read)((0,h.useState)(!1),2),U=V[0],z=V[1],K=null;if(B)if(B.error){if(B.error===S.ORDER_ERRORS.NOT_SIGNED_IN){K=(0,n.jsx)(v.default,(0,i.__assign)({className:"StickerPackPreview__purchase",size:"m",loading:A,onClick:function(){(0,_.showDoneBox)(_e("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))}},{children:_e("purchases_stickers_get_pack_btn")}),void 0)}else if(B.error===S.ORDER_ERRORS.NO_VALID_ITEMS){if(1===B.items.length){var q=B.items[0],Q=q.product,$=q.error;if(Q&&$!==S.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&Q.purchase_details){var J=Q.purchase_details,X=J.label,Z=J.title,Y=J.text,ee=J.button_title,te=J.button_url;K=(0,n.jsx)(v.default,(0,i.__assign)({className:"StickerPackPreview__purchase",size:"m",appearance:"primary",loading:A,onClick:function(){(0,a.showFastBox)(Z||_e("purchases_stickers_catalog_purchase_details_title"),Y,te&&ee||null,te?function(){window.location.href=te}:null)}},{children:X||_e("purchases_stickers_product_unavailable")}),void 0)}}if(!K){var re=!B.items.find((function(e){return e.error!==S.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT}));K=(0,n.jsx)(v.default,(0,i.__assign)({className:"StickerPackPreview__purchase",size:"m",appearance:"secondary",loading:A,disabled:!0},{children:_e(re?"purchases_stickers_product_purchased":"purchases_stickers_product_unavailable")}),void 0)}}}else{var ie=A||U;K=(0,n.jsx)(le.default,{className:"StickerPackPreview__purchase",size:"m",loading:ie,disabled:ie,price:B.price,text:B.price.current?_e("purchases_stickers_buy_for"):_e("purchases_stickers_get_for_free"),onClick:function(){U||(z(!0),L.order({ref:f,gift_ref:N}).then((function(e){z(!1),e&&!e.error&&(0,_.showDoneBox)((0,y.getPurchaseResult)(e))}),(function(){})))}},void 0)}var ae=!A&&void 0!==E.find((function(e){return null==e?void 0:e.can_gift})),oe=D.reduce((function(e,t){return t.product&&t.product.copyright&&e.add(t.product.copyright),e}),new Set),he=se.colorScheme.isDarkScheme()?c.Theme.DARK:c.Theme.LIGHT;return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerPackPreview"},{children:[(0,n.jsxs)("header",(0,i.__assign)({className:"StickerPackPreview__header"},{children:[(0,n.jsx)("a",(0,i.__assign)({className:"StickerPackPreview__close",onClick:j},{children:(0,n.jsx)(m.default,{},void 0)}),void 0),O&&(0,n.jsx)(W,{className:"StickerPackPreview__icon",sticker:O,theme:he,width:128,height:128},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackPreview__info"},{children:[(0,n.jsx)(p.default,(0,i.__assign)({element:"h1",className:"StickerPackPreview__title"},{children:t.title}),void 0),(0,n.jsx)(p.default,(0,i.__assign)({element:"div",className:"StickerPackPreview__author"},{children:t.author}),void 0),(0,n.jsx)(p.default,(0,i.__assign)({element:"div",className:"StickerPackPreview__description"},{children:t.description}),void 0)]}),void 0)]}),void 0),T.length>0&&(0,n.jsx)(ne,{className:"StickerPackPreview__styles",styles:T,isLoading:R,isAdded:function(e){return L.hasProduct(e.id)},add:function(e){return L.addProduct(e.id)},remove:function(e){return L.removeProduct(e.id)},gift:function(e){return t=e.id,void(0,ue.giftStickerProducts)([t],d);var t}},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackPreview__footerContainer"},{children:[(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackPreview__items"},{children:D.map((function(e){return(0,n.jsx)(ce,{item:e,showHeader:T.length>0,remove:e.product&&(0,c.isStyleProduct)(e.product)?function(){return L.removeProduct(e.product_id)}:void 0},e.product_id)}))}),void 0),oe.size>0&&(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackPreview__copyrights"},{children:Array.from(oe).map((function(e,t){return(0,n.jsx)("div",(0,i.__assign)({className:"StickerPackPreview__copyright"},{children:(0,de.decodeHTMLEntities)(e)}),t)}))}),void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerPackPreview__footer"},{children:[!A&&(F||ae)&&(0,n.jsx)("div",(0,i.__assign)({className:"StickerPackPreview__footerNote"},{children:H}),void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackPreview__footerButtons"},{children:[ae&&(0,n.jsxs)(g.default,(0,i.__assign)({className:"StickerPackPreview__gift",appearance:"primary",size:"m",onClick:function(){return(e=L.copy()).setRecipientIds(d),void(0,ue.giftStickersCart)(e);var e}},{children:[(0,n.jsx)(k,{width:20,height:20,className:"StickerPackPreview__giftIcon"},void 0),_e("purchases_stickers_gift")]}),void 0),K]}),void 0)]}),void 0)]}),void 0)]}),void 0)};var fe=r(43927),pe=r(39664),ge=f.default.getLang;const ve=function(e){var t=e.pack,r=e.options,s=e.closeBox,a=e.updateBox,u=(0,i.__read)(w(t.id),2),_=u[0],f=u[1];_&&(t=_);var m=(0,i.__read)(x(t.style_ids||[]),2),k=m[0],S=m[1],y=f||S;(0,h.useEffect)((function(){a()}),[y]);var P=(0,i.__assign)((0,i.__assign)({},t),{base_id:t.id,title:ge("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:t.sticker_ids}),I=(0,i.__spreadArray)([P],(0,i.__read)(k),!1),N=I.find((function(e){return e&&e.is_active}))||P,j=(0,i.__read)((0,h.useState)(),2),b=j[0],C=j[1],T=b&&I.find((function(e){return e&&e.id===b})),R=function(e){C(e&&e.id)},M=T||N,L=M===P?ge("purchases_stickers_product_preview_title_base_pack"):(0,o.langStr)(ge("purchases_stickers_product_preview_title_style"),"title",M.title);(0,h.useEffect)((function(){M.is_new&&(0,l.updateUserProductState)(M.id,c.UserProductStateKey.IsNew,0).finally((function(){}))}),[M,M.is_new]);var A=(0,i.__read)((0,h.useState)(!1),2),G=A[0],D=A[1],E=(0,i.__read)((0,h.useState)(!1),2),B=E[0],O=E[1];return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerPackSettings"},{children:[(0,n.jsx)(fe.ModalHeader,{className:"StickerPackSettings__header",title:t?(0,o.langStr)(ge("purchases_stickers_style_selection_for_pack"),"title",t.title):"",onClose:s},void 0),y?(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackSettings__content StickerPackSettings__content--loading"},{children:(0,n.jsx)(pe.default,{size:24},void 0)}),void 0):(0,n.jsxs)(h.Fragment,{children:[I.length>0&&(0,n.jsx)(ne,{className:"StickerPackSettings__styles",styles:I,isLoading:S,activeStyle:N,selectedStyle:M,select:function(e){return R(e)}},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackSettings__footerContainer"},{children:[(0,n.jsxs)("section",(0,i.__assign)({className:"StickerPackSettings__stylePreview"},{children:[(0,n.jsx)(p.default,(0,i.__assign)({element:"h2",className:"StickerPackSettings__stylePreviewTitle"},{children:L}),void 0),(0,n.jsx)(ae,{product:M},void 0)]}),void 0),(0,n.jsx)("footer",(0,i.__assign)({className:"StickerPackSettings__footer"},{children:(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackSettings__footerButtons"},{children:[M.can_gift&&(0,n.jsx)(g.default,{className:"StickerPackSettings__gift",appearance:"secondary",size:"m",onClick:function(){return e=M.id,void(0,ue.giftStickerProducts)([e],r.recipientIds||[]);var e}},void 0),M.is_purchased?(0,n.jsx)(v.default,(0,i.__assign)({className:"StickerPackSettings__activate",appearance:"primary",size:"m",disabled:M===N,loading:B,onClick:function(){return e=M,void(B||(O(!0),(0,l.activateProduct)(e).then((function(){O(!1),R(void 0)}),(function(){}))));var e}},{children:ge("purchases_stickers_product_settings_save")}),void 0):(0,n.jsx)(le.default,{className:"StickerPackSettings__buy",appearance:"primary",size:"m",price:M.price.purchase,text:M.price.purchase.current?ge("purchases_stickers_buy_for"):ge("purchases_stickers_get_for_free"),loading:G,onClick:function(){return e=M,void(G||(D(!0),d.Cart.create([e.id]).load().then((function(e){return e.order()})).then((function(){D(!1)}),(function(){}))));var e}},void 0)]}),void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)};var me=f.default.getLang;const ke=function(e){var t=e.style,r=e.options.add,s=e.closeBox;return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerStylePreview"},{children:[(0,n.jsx)(fe.ModalHeader,{className:"StickerStylePreview__header",title:(0,o.langStr)(me("purchases_stickers_stickers_of_style"),"title",t.title),onClose:s},void 0),(0,n.jsx)(ae,{className:"StickerStylePreview__content",product:t},void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerStylePreview__footer"},{children:[(0,n.jsx)(g.default,(0,i.__assign)({className:"StickerStylePreview__cancel",appearance:"tertiary",size:"m",onClick:s},{children:me("global_cancel")}),void 0),r&&(0,n.jsx)(g.default,(0,i.__assign)({className:"StickerStylePreview__add",appearance:"primary",size:"m",onClick:function(){return r(t)}},{children:me("purchases_stickers_preview_add_item")}),void 0)]}),void 0)]}),void 0)};var Se=new Map;function ye(e,t){var r=(0,_.showBoxLoader)();(0,u.getPackByStickerId)(e).then((function(e){!(0,_.isBoxLoadingCancelled)(r)&&e&&((0,_.hideBoxLoader)(),we(e.id,t))}),(function(){}))}function we(e,t){var r,u=(0,i.__assign)({},t);function h(){return null==r?void 0:r.bodyNode.querySelector(".StickersProductPreviewBox")}function f(){null==r||r.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function p(){null==r||r.updateBoxCoords()}function g(e,t){var r=null,i=null;if((0,c.isPackProduct)(e))r=e.is_purchased&&(null==u?void 0:u.settings)?(0,n.jsx)(ve,{pack:e,options:u,closeBox:f,updateBox:p},void 0):(0,n.jsx)(he,{pack:e,cart:t,options:u,closeBox:f,updateBox:p},void 0),i=e.name;else if((0,c.isStyleProduct)(e)){var a=(0,l.getProductFromCache)(e.base_id);if(a)return t.addProduct(a.id,!0),void g(a,t);r=(0,n.jsx)(ke,{style:e,options:u,closeBox:f,updateBox:p},void 0),i=e.name}var o=h();if(o&&r&&(s.render(r,o),i)){var d=window.nav.objLoc[0].split("/");"stickers"===d[0]&&d[1]!==i&&window.nav.setLoc({0:"stickers/"+i})}}var v=(0,_.showBoxLoader)(!1),m=d.Cart.create([e]);return Promise.all([m.load(),window.stManager.add(["stickers.css"])]).then((function(t){var n=(0,i.__read)(t,1)[0];if(!(0,_.isBoxLoadingCancelled)(v)){(0,_.hideBoxLoader)();var c=(0,l.getProductFromCache)(e);c&&!c.is_disabled?((r=new a.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow:function(){g(c,n),requestAnimationFrame((function(){p(),function(){if(Se.has(e)){var t=(0,_.getBoxLayerWrap)();t&&(t.scrollTop=Se.get(e)||0),Se.delete(e)}}()}))},onBeforeHide:function(){var t;(t=(0,_.getBoxLayerWrap)())&&Se.set(e,t.scrollTop)},onHideAttempt:function(){var e;return(e=h())&&s.unmountComponentAtNode(e),!0}})).content('<div class="StickersProductPreviewBox"></div>'),r.show()):(0,a.showFastBox)((0,o.getLang)("global_box_error_title"),(0,o.getLang)("purchases_stickers_product_not_found"))}}),(function(){})),{hide:f}}},10835:(e,t,r)=>{"use strict";r.d(t,{cacheProductsData:()=>a,getProductFromCache:()=>o,getProductsFromCache:()=>c,getProducts:()=>u,getProduct:()=>d,activateProduct:()=>_,updateUserProductState:()=>h});var i=r(70655),n=r(93680),s=r(65820),a=function(e,t){var r,n,a,o,c,l;void 0===t&&(t=[]);var u=(0,s.getCache)();if(e.stickers){var d=u.stickers;try{for(var _=(0,i.__values)(e.stickers),h=_.next();!h.done;h=_.next()){var f=h.value;d.has(f.id)?d.set(f.id,(0,i.__assign)((0,i.__assign)({},d.get(f.id)),f)):d.set(f.id,f)}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=_.return)&&n.call(_)}finally{if(r)throw r.error}}}if(e.products)try{for(var p=(0,i.__values)(e.products),g=p.next();!g.done;g=p.next()){var v=g.value;u.products.set(v.id,v),u.productPromises.delete(v.id)}}catch(e){a={error:e}}finally{try{g&&!g.done&&(o=p.return)&&o.call(p)}finally{if(a)throw a.error}}try{for(var m=(0,i.__values)(t),k=m.next();!k.done;k=m.next()){var S=k.value;u.products.has(S)||u.products.set(S,null),u.productPromises.delete(S)}}catch(e){c={error:e}}finally{try{k&&!k.done&&(l=m.return)&&l.call(m)}finally{if(c)throw c.error}}e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),(0,s.updateCache)(u)},o=function(e){return(0,s.getCache)().products.get(e)},c=function(e){var t=(0,s.getCache)().products;return e.map((function(e){return t.get(e)}))};var l=function(e){var t,r;if(!e.length)return Promise.resolve([]);var o,l=(0,s.getCache)(),u=l.productPromises,d=l.productIdsQueue,_=new Set;try{for(var h=(0,i.__values)(e),f=h.next();!f.done;f=h.next()){var p=f.value;if(u.has(p)){(g=u.get(p))&&_.add(g)}else{d.add(p);var g=(o=void 0,(o=(0,s.getCache)().productsPromise)||(o=new Promise((function(e){return setTimeout((function(){var t=(0,s.getCache)().productIdsQueue,r=Array.from(t);t.clear(),(0,s.updateCache)({productIdsQueue:t,productsPromise:void 0}),n.ajax.post("stickers.php",{act:"get_products",product_ids:r},{onDone:function(t){a(t,r),e([])},onFail:function(t){return console.error(t),a({},r),e([]),!0}})}),300)})),(0,s.updateCache)({productsPromise:o})),o);u.set(p,g),_.add(g)}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}return(0,s.updateCache)({productIdsQueue:d,productPromises:u}),Promise.all(_).then((function(){return c(e)}))},u=function(e,t){void 0===t&&(t=!0);var r=t?e.filter((function(e){return void 0===o(e)})):e;return r.length?l(r).then((function(){return c(e)})):Promise.resolve(c(e))},d=function(e,t){if(void 0===t&&(t=!0),t){var r=o(e);if(void 0!==r)return Promise.resolve(r)}return l([e]).then((function(){return o(e)}))},_=function(e){return new Promise((function(t){n.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone:function(e){a(e),t()},onFail:function(e){return console.error(e),t(),!0}})}))},h=function(e,t,r,i){return void 0===i&&(i=!0),new Promise((function(s){n.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:r},{onDone:function(e){i&&a(e),s()},onFail:function(e){return console.error(e),s(),!0}})}))}},40060:(e,t,r)=>{"use strict";r.d(t,{giftStickerProducts:()=>A,giftStickersCart:()=>L});var i=r(70655),n=r(85893),s=r(73935),a=r(54612),o=r(99321),c=r(48230),l=r(65820),u=r(67294),d=r(86125),_=r(86067),h=r(41650),f=r(43927),p=r(39664),g=r(73947),v=r(74041),m=r(79806),k=r(99940),S=r(49091),y=r(22377),w=r(50134),P=r(83295),x={s:56,m:96,l:168};const I=function(e){var t,r,s,a,o,c=e.order,l=e.forceValid,u=void 0!==l&&l,d=new Map,_=new Map;if(c)try{for(var h=(0,i.__values)(c.items),f=h.next();!f.done;f=h.next()){var p=f.value,g=p.product;g&&((0,S.isPackProduct)(g)?d.has(g)?null===(s=d.get(g))||void 0===s||s.push(p):d.set(g,[p]):(0,S.isStyleProduct)(g)&&(_.has(g)?null===(a=_.get(g))||void 0===a||a.push(p):_.set(g,[p])))}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}var v=d.keys().next().value,m=(v?1:0)+_.size,k=m>1?m>2?"s":"m":"l",w=x[k],I=Array.from(_.entries());u||I.sort((function(e,t){var r=(0,i.__read)(e,2)[1];return(0,i.__read)(t,2)[1].filter((function(e){return!e.error})).length-r.filter((function(e){return!e.error})).length}));var N=I.slice(0,3),j=I.slice(3),b=!0;if(!u){var C=j.filter((function(e){return(0,i.__read)(e,2)[1].find((function(e){return!e.error}))}));C.length?j=C:b=!1}return(0,n.jsxs)("ul",(0,i.__assign)({className:"StickerProductsGiftIcons"},{children:[v&&(0,n.jsx)("li",{className:(0,P.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+k,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!u&&!(null===(o=d.get(v))||void 0===o?void 0:o.find((function(e){return!e.error})))}),style:{backgroundImage:"url("+(0,y.getStickerPackIconUrl)(v,w,w)+")"}},v.id),N.map((function(e){var t=(0,i.__read)(e,2),r=t[0],s=t[1];return(0,n.jsx)("li",{className:(0,P.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+k,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!u&&!s.find((function(e){return!e.error}))}),style:{backgroundImage:"url("+(0,y.getStickerPackIconUrl)(r,w,w)+")"}},r.id)})),j.length?(0,n.jsxs)("li",(0,i.__assign)({className:(0,P.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+k,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!b})},{children:["+",j.length]}),"more"):null]}),void 0)};var N=r(13984),j=h.default.getLang;function b(e){var t=e.getPack(),r=e.getStyles(),i="";return r.length&&(i=r.map((function(e){return(0,_.langStr)(j("purchases_stickers_gift_details_recipient_style_title"),"title",e.title)})).join(", ")),t?i?(0,_.langStr)(j("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",i):(0,_.langStr)(j("purchases_stickers_gift_details_recipient_pack"),"title",t.title):i?(0,_.langStr)(j("purchases_stickers_gift_details_recipient_styles"),"style_titles",i):null}const C=function(e){var t,r,s=e.order,a=e.recipients,o=function(e){var t,r;if(!e)return null;var n=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),s=n.filter((function(e){return!e.error&&!(0,y.isSampleOrderItem)(e)}));s.length&&(n=s);var a=[],o=[];try{for(var c=(0,i.__values)(n),l=c.next();!l.done;l=c.next()){var u=l.value,d=u.product;d&&((0,S.isPackProduct)(d)?a.push(u):(0,S.isStyleProduct)(d)&&o.push(u))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var h=o.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);if(a.length){var f=a.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);return o.length?(0,_.langStr)(j("purchases_stickers_gift_details_summary_pack_with_styles",o.length),"pack_price_sum",j("global_n_votes",f),"styles_num",o.length,"styles_price_sum",j("global_n_votes",h)):(0,_.langStr)(j("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",j("global_n_votes",f))}if(o.length)return(0,_.langStr)(j("purchases_stickers_gift_details_summary_styles",o.length),"styles_num",o.length,"styles_price_sum",j("global_n_votes",h));return null}(s),c=new Map;try{for(var l=(0,i.__values)(s.items),d=l.next();!d.done;d=l.next()){var h=d.value,f=h.error,p=h.product,g=h.recipient_id;if(!f){var v=a.get(g);if(v){var m=c.get(v);m||(m=new S.ProductsByType,c.set(v,m)),m.add(p)}}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}var k=Array.from(c.entries()),w=(0,u.useRef)(null);return(0,u.useEffect)((function(){var e=w.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGiftDetails",ref:w},{children:[o&&(0,n.jsx)(N.default,(0,i.__assign)({element:"p",className:"StickerProductsGiftDetails__summary"},{children:o}),void 0),k.length>0&&(0,n.jsx)("ul",(0,i.__assign)({className:"StickerProductsGiftDetails__recipients"},{children:k.map((function(e){var t=(0,i.__read)(e,2),r=t[0],s=t[1];return(0,n.jsxs)("li",(0,i.__assign)({className:"StickerProductsGiftDetails__recipient"},{children:[(0,n.jsx)(N.default,(0,i.__assign)({element:"div",className:"StickerProductsGiftDetails__recipientName"},{children:r[1]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGiftDetails__recipientProducts"},{children:b(s)}),void 0)]}),r[0])}))}),void 0)]}),void 0)};var T=r(69783),R=h.default.getLang;const M=function(e){var t=e.cart,r=e.options,s=r.ref,a=r.gift_ref,o=e.closeBox,c=e.updateBox,l=(0,i.__read)((0,w.useCart)(t),2),h=l[0],P=l[1],x=!h.isLoaded()&&P;(0,u.useEffect)((function(){c()}),[x]);var N=h.getRecipientIds(),j=h.getOrder(),b=j&&!j.error&&j.items.find((function(e){return!e.error&&!(0,y.isSampleOrderItem)(e)})),M=(0,i.__read)(function(e){var t,r,n;if(!e)return[null,null];try{for(var s=(0,i.__values)(e.items),a=s.next();!a.done;a=s.next()){var o=a.value.product;if(o&&(0,S.isPackProduct)(o)){n=o;break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var c=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),l=c.filter((function(e){return!e.error&&!(0,y.isSampleOrderItem)(e)}));l.length&&(c=l);var u=new S.ProductsByType(c.map((function(e){return e.product}))),d=u.pack.values().next().value,h=Array.from(u.style),f="",p="";if(1===h.length)f=(0,_.langStr)(R("purchases_stickers_gift_title_1_style"),"title",h[0].title),d?p=(0,_.langStr)(R("purchases_stickers_gift_description_with_pack"),"title",d.title):n&&(p=(0,_.langStr)(R("purchases_stickers_gift_description_for_pack"),"title",n.title));else if(d){if(f=(0,_.langStr)(R("purchases_stickers_gift_title_pack"),"title",d.title),h.length)switch(h.length){case 2:p=(0,_.langStr)(R("purchases_stickers_gift_description_with_2_styles"),"title1",h[0].title,"title2",h[1].title);break;case 3:p=(0,_.langStr)(R("purchases_stickers_gift_description_with_3_styles"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;case 4:p=(0,_.langStr)(R("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;default:var g=h.length-3;p=(0,_.langStr)(R("purchases_stickers_gift_description_with_3_styles_and_n_more",g),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title,"n",g)}}else if(h.length){switch(h.length){case 2:f=(0,_.langStr)(R("purchases_stickers_gift_title_2_styles"),"title1",h[0].title,"title2",h[1].title);break;case 3:f=(0,_.langStr)(R("purchases_stickers_gift_title_3_styles"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;case 4:f=(0,_.langStr)(R("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;default:g=h.length-3;f=(0,_.langStr)(R("purchases_stickers_gift_title_3_styles_and_n_more",g),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title,"n",g)}n&&(p=(0,_.langStr)(R("purchases_stickers_gift_description_for_pack"),"title",n.title))}h.length?p+=" "+R("purchases_stickers_gift_description_styles"):p+=" "+R("purchases_stickers_gift_description");return[f,p]}(j),2),L=M[0],A=M[1],G=(0,i.__read)((0,u.useState)(null),2)[1];(0,u.useLayoutEffect)((function(){var e,t,r=h.getRecipients();if(G(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:r,items:r,noResult:R("gifts_nobody_found"),introText:R("gifts_start_typing_recipient"),maxItems:20,onChange:function(e,t){1===e?h.addRecipientId(+t):h.removeRecipientId(+t)}})),N.length)try{for(var n=(0,i.__values)(N),s=n.next();!s.done;s=n.next()){var a=s.value,o=h.getRecipientById(a);o&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return function(){window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[x]);var D=(0,i.__read)((0,u.useState)(""),2),E=D[0],B=D[1],O=(0,i.__read)((0,u.useState)(!1),2),H=O[0],F=O[1],V=(0,i.__read)((0,u.useState)(!1),2),U=V[0],z=V[1],K=function(){U||(z(!0),h.order({message:E,is_private:H,ref:s,gift_ref:a}).then((function(e){z(!1),e&&!e.error&&((0,d.showDoneBox)(function(e,t){var r,n,s=new S.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),a=function(e){var t=e.getPack(),r=e.getStyles();if(t)return r.length?(0,_.langStr)(R("purchases_stickers_gift_result_products_pack_and_styles",r.length),"title",t.title,"styles_num",r.length):(0,_.langStr)(R("purchases_stickers_gift_result_products_pack"),"title",t.title);if(r.length)switch(r.length){case 1:return(0,_.langStr)(R("purchases_stickers_gift_result_products_1_style"),"title",r[0].title);case 2:return(0,_.langStr)(R("purchases_stickers_gift_result_products_2_styles"),"title1",r[0].title,"title2",r[1].title);case 3:return(0,_.langStr)(R("purchases_stickers_gift_result_products_3_styles"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);case 4:return(0,_.langStr)(R("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);default:var i=r.length-3;return(0,_.langStr)(R("purchases_stickers_gift_result_products_3_styles_and_n_more",i),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title,"n",i)}return null}(s);if(!a)return null;var o=new Set;try{for(var c=(0,i.__values)(e.items),l=c.next();!l.done;l=c.next()){var u=l.value,d=u.error,h=u.recipient_id;if(!d){var f=t(h);f&&o.add(f)}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}var p=function(e,t){var r=Array.from(e.values());switch(r.length){case 0:return null;case 1:var i=R(1===t?"purchases_stickers_gift_result_1_recipient_single":"purchases_stickers_gift_result_1_recipient_multiple",!0);return(0,_.langStr)((0,_.langSex)(r[0][7],i),"name",r[0][8]);case 2:return(0,_.langStr)(R("purchases_stickers_gift_result_2_recipients",t),"name1",r[0][8],"name2",r[1][8]);case 3:return(0,_.langStr)(R("purchases_stickers_gift_result_3_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8]);case 4:return(0,_.langStr)(R("purchases_stickers_gift_result_4_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8]);case 5:return(0,_.langStr)(R("purchases_stickers_gift_result_5_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8],"name5",r[4][8]);default:var n=r.length-4;i=R(1===t?"purchases_stickers_gift_result_4_recipients_and_n_more_single":"purchases_stickers_gift_result_4_recipients_and_n_more_multiple");return(0,_.langStr)(i,"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8],"n",n)}return null}(o,s.getCount());if(!p)return null;return(0,_.langStr)(p,"products",a)}(e,(function(e){return h.getRecipientById(e)}))),o())}),(function(){})))};return(0,u.useEffect)((function(){window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",U)}),[U]),(0,n.jsxs)("article",(0,i.__assign)({className:"StickerProductsGift"},{children:[(0,n.jsx)(f.ModalHeader,{className:"StickerProductsGift__header",title:R("purchases_stickers_gift_box_title"),onClose:o},void 0),x?(0,n.jsx)("section",(0,i.__assign)({className:"StickerProductsGift__content StickerProductsGift__content--loading"},{children:(0,n.jsx)(p.default,{size:24},void 0)}),void 0):(0,n.jsxs)(u.Fragment,{children:[(0,n.jsxs)("section",(0,i.__assign)({className:"StickerProductsGift__content"},{children:[(0,n.jsx)(I,{order:j,forceValid:!b},void 0),(0,n.jsx)("h1",(0,i.__assign)({className:"StickerProductsGift__productsTitle"},{children:L}),void 0),(0,n.jsx)("p",(0,i.__assign)({className:"StickerProductsGift__productsDescription"},{children:A}),void 0),j&&(0,n.jsxs)(u.Fragment,{children:[(0,n.jsxs)("dl",(0,i.__assign)({className:"StickerProductsGift__price"},{children:[(0,n.jsx)("dt",(0,i.__assign)({className:"StickerProductsGift__priceLabel"},{children:R("purchases_gift_price_label")}),void 0)," ",(0,n.jsx)("dd",(0,i.__assign)({className:"StickerProductsGift__priceValue"},{children:R("global_n_votes",j.price.current)}),void 0)]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__balance"},{children:(0,_.langStr)(R("gifts_you_have_X_votes"),"votes",R("global_n_votes",j.balance))}),void 0)]},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__recipients"},{children:[(0,n.jsx)("label",(0,i.__assign)({className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput"},{children:R("gifts_receiver")}),void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown"},{children:[(0,n.jsx)("div",{className:"fl_r wdd_arr"},void 0),(0,n.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:R("gifts_choose_recipients")},void 0)]}),void 0)]}),void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__message"},{children:[(0,n.jsx)("label",(0,i.__assign)({className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput"},{children:R("purchases_gift_your_message")}),void 0),(0,n.jsx)(g.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:E,onChange:function(e){return B(e.currentTarget.value)},onResize:function(){return c()},style:{height:80},disabled:U},void 0)]}),void 0),(0,n.jsx)(v.default,(0,i.__assign)({className:"StickerProductsGift__isPrivate",checked:H,disabled:U,onChange:function(){return F(!H)}},{children:R("gifts_receiver_only")}),void 0)]}),void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerProductsGift__footer"},{children:[(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__footerNote"},{children:!P&&j&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__details"},{children:[R("purchases_stickers_gift_details_label"),(0,n.jsx)(k.default,(0,i.__assign)({className:"StickerProductsGift__detailsTooltip",text:(0,n.jsx)(C,{order:j,recipients:h.getRecipientsMap()},void 0),position:"t",align:"center",appearance:"light"},{children:(0,n.jsx)(m.default,{className:"StickerProductsGift__detailsHintIcon"},void 0)}),void 0)]}),void 0)}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__footerButtons"},{children:(0,n.jsx)(T.default,{className:"StickerProductsGift__gift",appearance:b?"primary":"secondary",size:"m",loading:P||U,disabled:!b,price:null==j?void 0:j.price,text:b?(0,_.langStr)(R("purchases_stickers_gift_send_for"),"price",R("global_n_votes",null==j?void 0:j.price.current)):R("purchases_stickers_gift_send"),onClick:function(){return K()}},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)};function L(e,t){var r;if((0,l.getCache)().productsGiftLock)return null;(0,l.updateCache)({productsGiftLock:!0});var o=(0,i.__assign)({},t);function u(){return null==r?void 0:r.bodyNode.querySelector(".StickersProductsGift")}function d(){null==r||r.hide()}function _(){null==r||r.updateBoxCoords()}return(0,c.showLoader)(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css","wide_dd.js","wide_dd.css"])]).then((function(e){var t=(0,i.__read)(e,1)[0];(0,c.hideLoader)(),r=new a.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow:function(){!function(e){var t=u();t&&s.render((0,n.jsx)(M,{cart:e,options:o,closeBox:d,updateBox:_},void 0),t)}(t),requestAnimationFrame((function(){_()}))},onHideAttempt:function(){var e;return(e=u())&&s.unmountComponentAtNode(e),!0},onHide:function(){(0,l.updateCache)({productsGiftLock:!1})}}),r.content('<div class="StickersProductsGift"></div>'),r.show()}),(function(){})),{hide:d}}function A(e,t,r){return void 0===t&&(t=[]),L(o.Cart.create(e,t),r)}},48230:(e,t,r)=>{"use strict";r.d(t,{getBoxLayerWrap:()=>d,showLoader:()=>_,hideLoader:()=>h,getPurchaseResult:()=>f,updateStickersFromQueue:()=>p});var i=r(86067),n=r(41650),s=r(11417),a=r(15544),o=r(86125),c=r(49091),l=n.default.getLang;function u(){return document.querySelector("#box_loader")}function d(){return document.querySelector("#box_layer_wrap")}function _(){var e=u();(0,o.boxRefreshCoords)(e),(0,a.show)(e),(0,a.show)(d())}function h(){(0,a.hide)(u())}function f(e){var t=new c.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),r=t.getPack(),n=t.getStyles();if(r)return n.length?(0,i.langStr)(l("purchases_stickers_purchase_result_pack_and_styles",n.length),"pack_title",r.title,"n",n.length):(0,i.langStr)(l("purchases_stickers_purchase_result_pack"),"title",r.title);if(n.length)switch(n.length){case 1:return(0,i.langStr)(l("purchases_stickers_purchase_result_1_style"),"title",n[0].title);case 2:return(0,i.langStr)(l("purchases_stickers_purchase_result_2_styles"),"title1",n[0].title,"title2",n[1].title);case 3:return(0,i.langStr)(l("purchases_stickers_purchase_result_3_styles"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);case 4:return(0,i.langStr)(l("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);default:var s=n.length-3;return(0,i.langStr)(l("purchases_stickers_purchase_result_3_styles_and_n_more",s),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title,"n",s)}return null}function p(e){var t,r;t=e,r=s.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light",t.querySelectorAll(".sticker_img["+r+"]").forEach((function(e){var t=e.getAttribute(r);t&&(e.src=t)}))}},75867:(e,t,r)=>{"use strict";r.d(t,{vmojiSubscribeToQueue:()=>s,vmojiPurchaseProduct:()=>a,vmojiGetAvatar:()=>o,vmojiGetStickerPacksRecommendationBlocks:()=>c,vmojiGetStickerPacksRecommendationBlock:()=>l,vmojiGetStickerPacks:()=>u,vmojiGetCharacterById:()=>d,vmojiSetAvatarState:()=>_,storeActivateProduct:()=>h,storeDeactivateProduct:()=>f,VmojiLangSection:()=>i,vmojiGetLangs:()=>p});var i,n=r(89798),s=function(){return(0,n.api)("vmoji.subscribeToQueue",{})},a=function(e,t){return void 0===t&&(t=!1),(0,n.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0})},o=function(e){var t={};return e&&Object.assign(t,{avatar_id:e}),(0,n.api)("vmoji.getAvatar",t)},c=function(e){return(0,n.api)("vmoji.getStickerPacksRecommendationBlocks",e)},l=function(e,t){var r={block_id:e};return t&&Object.assign(r,{count:t}),(0,n.api)("vmoji.getStickerPacksRecommendationBlock",r)},u=function(e){return(0,n.api)("vmoji.getStickerPacks",e)},d=function(e,t){return(0,n.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0})},_=function(e,t){return(0,n.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0})},h=function(e){return(0,n.api)("store.activateProduct",{type:"stickers",product_id:e})},f=function(e){return(0,n.api)("store.deactivateProduct",{type:"stickers",product_id:e})};!function(e){e.LAYER="layer",e.PURCHASE="purchase"}(i||(i={}));var p=function(e){return new Promise((function(t,r){window.ajax.post("al_vmoji.php",{act:"lang_keys",section:e},{onDone:function(){t()},onFail:function(){return r(),!1}})}))}}}]);try{stManager.done("dist/34070b9b70cb2bcd6cda415005720c20.69f0a9b432e3179b3d52.js")}catch(e){}